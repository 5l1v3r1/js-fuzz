#!/usr/bin/env node

'use strict'

process.env.TERM = 'windows-ansi' // hack for Cygwin/conemu

const Cluster = require('../lib/src/Cluster').Cluster
const path = require('path')
const os = require('os')

const argv = require('yargs')
  .usage('Usage: $0 <file> [--exclude package1 package2]')
  .demandCommand(1, 'Please specify a file to fuzz')
  .options({
    e: {
      alias: 'exclude',
      describe: 'List of package regexes that will be excluded from coverage analysis',
      type: 'array',
      default: []
    },
    w: {
      alias: 'workers',
      describe: 'The number of workers to spawn to run fuzzing.',
      default: os.cpus().length
    },
    q: {
      alias: 'quiet',
      describe: 'Hide the stats output',
      default: false
    }
  })
  .argv

const c = new Cluster({
  target: path.resolve(process.cwd(), argv._[0]),
  exclude: argv.exclude,
  workers: argv.workers,
  quiet: argv.quiet
})

c.start()
